(function(){var a,b,c=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b=!1,a=!1,window.Progressio=function(){function d(a){var c;try{if("object"!=typeof a&&(a={}),this._options={color:a.color||"blue",fixed:a.fixed||!1,location:a.location||"top",container:a.container||"#body",load_bar:a.load_bar||"body",auto_hide:a.auto_hide||!1,callbacks:a.callbacks||-1,console:a.console||-1},this._deps={jquery:jQuery,"jquery.timers":jQuery.timers},this._jQuery=this._deps.jquery,"object"!=typeof this._options.console&&(this._options.console={log:function(){},info:function(){},debug:function(){},warn:function(){},error:function(){},trace:function(){},timeEnd:function(){},time:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},dir:function(){},count:function(){}}),b===!0)throw new Error("Cannot instanciate Progressio more than once!");this.ProgressioPage=new f(this,this._options,this._deps),this.ProgressioRegistry=new g(this,this._options,this._deps),this.ProgressioMisc=new e(this,this._options,this._deps),this.ProgressioPage.register(),this.ProgressioMisc.register(),this.ProgressioRegistry.events(),b=!0}catch(d){c=d,this._options.console.error("Progressio.constructor",c)}}var e,f,g;return d.prototype.apply=function(){var b,c,d,e,f,g;try{if(this._options.console.info("Progressio.apply","Applying Progressio..."),a===!0)throw new Error("Cannot apply Progressio DOM more than once!");for(g=this._deps,c=e=0,f=g.length;f>e;c=++e)if(b=g[c],"undefined"==typeof c)throw new Error("Could not find dependency: "+b+"! Library load aborted.");return this.color(this._options.color),a=!0,this._options.console.info("Progressio.apply","Applied.")}catch(h){return d=h,this._options.console.error("Progressio.apply",d)}},d.prototype.color=function(a){var b,c,d,e,f,g,h;try{if(h=this,this._options.console.info("Progressio.color","Changing bar color to "+a+"..."),this._options.color=a||"blue",f=!0,e=this._jQuery(".progressio-container"),d="progressio-container",this._options.fixed===!0&&(d=""+d+" progressio-position-fixed","bottom"===this._options.location&&(d=""+d+" progressio-location-bottom")),d=this._options.auto_hide===!0?""+d+" progressio-visibility-hide":""+d+" progressio-visibility-show",b=this._options.color||"blue",c="progressio-color-"+b,e.size()&&(e.filter("."+c).size()?f=!1:e.remove()),f===!0)return this._loader_bar_sel=this._jQuery('<div class="progressio-bar"></div>'),this._loader_bar_container_sel=this._jQuery('<div class="'+d+" "+c+'"></div>'),this._loader_bar_container_sel.append(this._loader_bar_sel),this._jQuery(this._options.load_bar).prepend(this._loader_bar_container_sel),this._options.auto_hide===!0&&this.ProgressioPage._begin_progress_bar(null,function(){return h.ProgressioPage._end_progress_bar()}),this._options.console.info("Progressio.color","Changed bar color to "+a+".")}catch(i){return g=i,this._options.console.error("Progressio.color",g)}},d.prototype.update=function(){var a;try{return this.ProgressioPage.fire_dom_updated()}catch(b){return a=b,this._options.console.error("Progressio.update",a)}},d.prototype.get_id=function(){var a;try{return this.ProgressioPage.get_id()}catch(b){return a=b,this._options.console.error("Progressio.get_id",a)}},d.prototype.open=function(a){var b;try{return this.ProgressioPage.open_page(a)}catch(c){return b=c,this._options.console.error("Progressio.open",b)}},d.prototype.register_event=function(a,b,c,d){var e;try{return this.ProgressioRegistry.register_event(a,b,c,d)}catch(f){return e=f,this._options.console.error("Progressio.register_event",e)}},f=function(){function a(a,b,c){var d;try{this.__=a,this._options=b,this._jQuery=c.jquery,this._window_sel=this._jQuery(window),this._document_sel=this._jQuery(document),this._head=this._jQuery("head"),this._id_async=0,this._is_async_compatible=window.history&&history.pushState&&!0,this._http_protocol=document.location.protocol.replace(":",""),this._http_host=document.location.host,this._state_url=document.location.pathname}catch(e){d=e,this._options.console.error("Progressio.ProgressioPage.constructor",d)}}return a.prototype.register=function(){var a;try{return this.__.ProgressioRegistry.register_event("progressio:page:events_state_change",this.events_state_change,this),this.__.ProgressioRegistry.register_event("progressio:page:async_load",this.events_async_load,this)}catch(b){return a=b,this._options.console.error("Progressio.ProgressioPage.register",a)}},a.prototype.purge_global_events=function(){var a;try{return this._window_sel.off(),this._document_sel.off()}catch(b){return a=b,this._options.console.error("Progressio.ProgressioPage.purge_global_events",a)}},a.prototype.open_page=function(a){var b;try{return this._is_async_compatible?this._run_async_load(a):document.location.href=a}catch(c){return b=c,this._options.console.error("Progressio.ProgressioPage.open_page",b)}},a.prototype.events_async_load=function(a){var b,c,d,e;try{if(e=this,!this._is_async_compatible)return this._options.console.error("Progressio.ProgressioPage.events_async_load","Woops, your browser is not compatible with asynchronous page load!");if(b=this._eligible_links_async_load().hasParent(a),c=b.size(),b.click(function(a){var b,c;b=!1;try{return e.__.ProgressioMisc.key_event().ctrlKey||e.__.ProgressioMisc.key_event().metaKey?b=!0:e._run_async_load(e._jQuery(this).attr("href"))}catch(c){return c=c,e._options.console.error("Progressio.ProgressioPage.events_async_load[async]",c)}finally{return b}}),b.attr("data-progressio-async","active"),c)return this._options.console.debug("Progressio.ProgressioPage.events_async_load","Yay! "+c+" internal links ajax-ified.")}catch(f){return d=f,this._options.console.error("Progressio.ProgressioPage.events_async_load",d)}},a.prototype.events_state_change=function(){var a,b,c;try{return b=this,c=function(a){var c;return c=document.location.pathname,c!==b._state_url?(b._state_url=c,b._run_async_load(b._state_url)):void 0},this._window_sel.off("popstate"),this._window_sel.off("pushstate"),this._window_sel.on("popstate",c),this._window_sel.on("pushstate",c)}catch(d){return a=d,this._options.console.error("Progressio.ProgressioPage.events_state_change",a)}},a.prototype.fire_dom_updated=function(){var a;try{return this.events_async_load("body")}catch(b){return a=b,this._options.console.error("Progressio.ProgressioPage.fire_dom_updated",a)}},a.prototype.get_id=function(){var a;try{return this._id_async}catch(b){return a=b,this._options.console.error("Progressio.ProgressioPage.get_id",a)}},a.prototype._eligible_links_async_load=function(){var a,b,c,d;try{return d=this,b=""+this._http_protocol+"://"+this._http_host+"/",c=new RegExp("^("+b+"|(.?/(?!https?://).*))","gi"),this._document_sel.find('a[href]:not([target="_blank"], [data-progressio-async="disabled"], [data-progressio-async="active"])').filter(function(){return d._jQuery(this).attr("href").match(c)})}catch(e){return a=e,this._options.console.error("Progressio.ProgressioPage._eligible_links_async_load",a)}},a.prototype._run_async_load=function(a){var b,c,d,e;try{return e=this,this._begin_progress_bar(),this._hide_error_alert(),c=++this._id_async,d=function(b){return e._handle_async_load(c,a,b)},this._jQuery.ajax({url:a,headers:{"X-Requested-With":"Progressio"},type:"GET",success:d,error:d}),this._options.console.debug("Progressio.ProgressioPage._run_async_load","Loading page: "+a)}catch(f){return b=f,this._options.console.error("Progressio.ProgressioPage._run_async_load",b)}},a.prototype._handle_async_load=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;try{return o=this,"object"==typeof c&&c.hasOwnProperty("responseText")&&(c=c.responseText),a===this._id_async?(i=this._jQuery(c),l=i.filter(""+this._options.container+":first"),l.size()?(p=i.filter("title:first"),d=0,m=this._document_sel.find('script:not([data-progressio-scope="common"])'),n=this._document_sel.find('link[rel="stylesheet"]:not([data-progressio-scope="common"])'),e=function(){return m.remove(),n.remove(),o._options.console.debug("Progressio.ProgressioPage._handle_async_load","Done cleanup of old DOM before page: "+b)},g=function(){var a;return o._end_progress_bar(),"object"==typeof o._options.callbacks&&"object"==typeof o._options.callbacks.post_display&&"function"==typeof o._options.callbacks.post_display.before&&o._options.callbacks.post_display.before()===!0&&(o._scroll_top(),a=o._options.callbacks.post_display.after,"function"===a&&o._options.callbacks.post_display.after()),o._options.console.debug("Progressio.ProgressioPage._handle_async_load","Done post display actions for page: "+b)},f=function(){return o._document_sel.oneTime(250,function(){var a,c,d;return"object"==typeof o._options.callbacks&&"object"==typeof o._options.callbacks.on_complete&&"function"==typeof o._options.callbacks.on_complete.before&&o._options.callbacks.on_complete.before()===!0&&(a=o._options.callbacks.on_complete.after,"function"===a&&o._options.callbacks.on_complete.after()),e(),o._document_sel.find("title").replaceWith(p),o._document_sel.find(""+o._options.container).remove(),d=o._document_sel.find(""+o._options.container+"_new"),c=o.__.ProgressioMisc.split_selector_path(o._options.container),d.attr(c.attr,c.value).show(),o.__.ProgressioRegistry.restore_events(""+o._options.container),b!==o._state_url&&(o._state_url=b,history.pushState(null,p,b)),g(),o._options.console.debug("Progressio.ProgressioPage._handle_async_load","Loaded page: "+b)})},this.purge_global_events(),this.__.ProgressioRegistry.unload_bundles(),this._document_sel.find(""+this._options.container+"_new").remove(),h=this.__.ProgressioMisc.split_selector_path(this._options.container),l.attr(h.attr,""+h.value+"_new"),l.hide(),l.insertBefore(this._document_sel.find(""+this._options.container)),this._head.append(i.filter('script:not([src]):not([data-progressio-scope="common"])')),this._head.append(i.filter('link[rel="stylesheet"]:not([href]):not([data-progressio-scope="common"])')),k={js:[],css:[]},i.filter('script[src]:not([data-progressio-scope="common"])').each(function(){var a;return a=o._jQuery(this).attr("src"),a?k.js.push(a):void 0}),i.filter('link[href][rel="stylesheet"]:not([data-progressio-scope="common"])').each(function(){var a;return a=o._jQuery(this).attr("href"),a?k.css.push(a):void 0}),k.js.length||k.css.length?(k.js.length&&(d++,this._options.console.info("Progressio.ProgressioPage._handle_async_load","Loading scripts..."),LazyLoad.js(k.js,function(){return o._options.console.info("Progressio.ProgressioPage._handle_async_load[async]","Scripts fully loaded"),0===--d?f():void 0})),k.css.length&&(d++,this._options.console.info("Progressio.ProgressioPage._handle_async_load","Loading stylesheets..."),LazyLoad.css(k.css,function(){return o._options.console.info("Progressio.ProgressioPage._handle_async_load[async]","Stylesheets fully loaded"),0===--d?f():void 0})),this._options.console.debug("Progressio.ProgressioPage._handle_async_load","Delayed page load (waiting for sources to be loaded): "+b)):f()):(this._show_error_alert(10),this._end_progress_bar(),this._options.console.error("Progressio.ProgressioPage._handle_async_load","Got an abnormal or error response from: "+b))):this._options.console.warn("Progressio.ProgressioPage._handle_async_load","Dropped outpaced ID for page: "+b)}catch(q){return j=q,this._options.console.error("Progressio.ProgressioPage._handle_async_load",j)}},a.prototype._begin_progress_bar=function(a,b){var c;try{return this.__._loader_bar_sel.stop(!0),this.__._loader_bar_sel.css({width:0}),this._options.auto_hide===!0&&(this.__._loader_bar_container_sel.stop(!0),this.__._loader_bar_container_sel.fadeIn(250)),"function"==typeof a&&a(),this.__._loader_bar_sel.addClass("animated"),this.__._loader_bar_sel.animate({width:"50%"},600,"easeOutQuad",function(){return"function"==typeof b?b():void 0})}catch(d){return c=d,this._options.console.error("Progressio.ProgressioPage._begin_progress_bar",c)}},a.prototype._end_progress_bar=function(a,b){var c,d;try{return d=this,"function"==typeof a&&a(),this.__._loader_bar_sel.animate({width:"100%"},300,"linear",function(){return d.__._loader_bar_sel.removeClass("animated"),d._options.auto_hide===!0&&(d.__._loader_bar_container_sel.stop(!0),d.__._loader_bar_container_sel.fadeOut(400)),"function"==typeof b?b():void 0})}catch(e){return c=e,this._options.console.error("Progressio.ProgressioPage._end_progress_bar",c)}},a.prototype._get_error_alert=function(){var a;try{return this._document_sel.find(".alerts .async-load-error")}catch(b){return a=b,this._options.console.error("Progressio.ProgressioPage._get_error_alert",a)}},a.prototype._show_error_alert=function(a){var b,c;null==a&&(a=10);try{return c=this._get_error_alert(),c.stop(!0).hide(),c.animate({height:"toggle",opacity:"toggle"},400,function(){return this._jQuery(this).oneTime(""+a+"s",function(){return this._jQuery(this).animate({height:"toggle",opacity:"toggle"},400)})})}catch(d){return b=d,this._options.console.error("Progressio.ProgressioPage._show_error_alert",b)}},a.prototype._hide_error_alert=function(){var a,b;try{if(b=this._get_error_alert().filter(":visible"),b.size())return b.stopTime(),b.stop(!0).animate({height:"toggle",opacity:"toggle"},250)}catch(c){return a=c,this._options.console.error("Progressio.ProgressioPage._hide_error_alert",a)}},a.prototype._scroll_top=function(){var a;try{return this._window_sel.scrollTop(0)}catch(b){return a=b,this._options.console.error("Progressio.ProgressioPage._scroll_top",a)}},a}(),g=function(){function a(a,b,c){var d;try{this.__=a,this._options=b,this._jQuery=c.jquery,this._registry_events={},this._registry_bundles=[]}catch(e){d=e,this._options.console.error("Progressio.ProgressioRegistry.constructor",d)}}return a.prototype.events=function(){var a;try{return this._bind_events("body")}catch(b){return a=b,this._options.console.error("Progressio.ProgressioRegistry.events",a)}},a.prototype._bind_events=function(a){var b,c,d,e,f,g,h;try{a=a||"body",d="body"===a,b=null,g=this._registry_events,h=[];for(e in g){b=g[e];try{d&&b[2]||b[0].bind(b[1])(a),h.push(this._options.console.debug("Progressio.ProgressioRegistry._bind_events[loop]","Bound callback function for "+e))}catch(f){f=f,h.push(this._options.console.error("Progressio.ProgressioRegistry._bind_events[loop]","Registry callback function execution failed for "+(""+e+" with error message: "+f)))}}return h}catch(f){return c=f,this._options.console.error("Progressio.ProgressioRegistry._bind_events",c)}},a.prototype.register_event=function(a,b,c,d){var e;try{return d=d,this._registry_events[a]=[b,c,d],this._options.console.info("Progressio.ProgressioRegistry.register_event","Registered event: "+a)}catch(f){return e=f,this._options.console.error("Progressio.ProgressioRegistry.register_event",e)}},a.prototype.unregister_event=function(a){var b;try{return c.call(this._registry_events,a)>=0?(delete this._registry_events[a],this._options.console.info("Progressio.ProgressioRegistry.unregister_event","Unregistered event: "+a),!0):!1}catch(d){return b=d,this._options.console.error("Progressio.ProgressioRegistry.unregister_event",b)}},a.prototype.init_events=function(){var a;try{return this._bind_events("body")}catch(b){return a=b,this._options.console.error("Progressio.ProgressioRegistry.init_events",a)}},a.prototype.restore_events=function(a){var b;try{return this._bind_events(a)}catch(c){return b=c,this._options.console.error("Progressio.ProgressioRegistry.restore_events",b)}},a.prototype.register_bundle=function(a){var b;try{return this._registry_bundles.push(a)}catch(c){return b=c,this._options.console.error("Progressio.ProgressioRegistry.register_bundle",b)}},a.prototype.unload_bundles=function(){var a,b,c,d,e,f;try{for(a=0,f=this._registry_bundles,d=0,e=f.length;e>d;d++)b=f[d],this.hasOwnProperty(b)&&(delete _[b],a++);return this._options.console.info("Progressio.ProgressioRegistry.unload_bundles","Unloaded "+a+" bundles")}catch(g){return c=g,this._options.console.error("Progressio.ProgressioRegistry.unload_bundles",c)}},a}(),e=function(){function a(a,b,c){var d;try{this.__=a,this._options=b,this._jQuery=c.jquery,this._window_sel=this._jQuery(window),this._key_event={}}catch(e){d=e,this._options.console.error("Progressio.ProgressioMisc.constructor",d)}}return a.prototype.register=function(){var a;try{return this.__.ProgressioRegistry.register_event("progressio:misc:events_key",this.events_key,this)}catch(b){return a=b,this._options.console.error("Progressio.ProgressioMisc.register",a)}},a.prototype.events_key=function(){var a,b;try{return b=this,this._window_sel.keydown(function(a){return b._key_event=a}),this._window_sel.keyup(function(){return b._key_event={}})}catch(c){return a=c,this._options.console.error("Progressio.ProgressioMisc.events_key",a)}},a.prototype.key_event=function(){var a;try{return this._key_event}catch(b){return a=b,this._options.console.error("Progressio.ProgressioMisc.key_event",a)}},a.prototype.split_selector_path=function(a){var b,c,d;c={attr:"data-selector",value:null};try{switch(d=a.substr(0,1),c.value=a.substr(1,a.length),d){case"#":c.attr="id";break;case".":c.attr="class"}}catch(e){return b=e,this._options.console.error("Progressio.ProgressioMisc.split_selector_path",b)}finally{return c}},a}(),d}()}).call(this);